export username=dev
export password=Boot@123

checkVersionLimit()
{
	export token_json=$(curl -k -v -d "grant_type=password&username="$username"&password="$password"&client_id=bootnext" -H "Accept: application/json" -H "Content-Type: application/x-www-form-urlencoded" -X POST $hostName/auth/realms/$realm/protocol/openid-connect/token | { read -r body;read -r code;echo "Response Code for token > "$code >> wso2carbon.log ;if [[ $code -ne 200 ]]; then echo "body"$body >> wso2carbon.log;  fi; echo $body; }) 
	export token=$(echo $token_json | jq -r ".access_token // empty")
	}


export IMPORT_JSON=$(jq -nf metadata.json)
export hostName=$(echo $IMPORT_JSON |jq -r ".hostName // empty")
export realm=$(echo $IMPORT_JSON |jq -r ".realm // empty")
export gateWayContext=$(echo $IMPORT_JSON |jq -r ".gatewayContext // empty")
export applicationName=$(echo $IMPORT_JSON |jq -r ".applicationName // empty")
export hostUrl=$hostName/$gateWayContext
checkVersionLimit
echo $PWD

export aoaImport=$(curl -k -v -d '[{"applicationName":"SUPERAPP_APP_NAME","internalSchema":[{"schemaName":"superapp","entities":[{"entityName":"com.enttribe.superapp.model.HostingDetails","entityAndCoulmnRestriction":true,"columns":[{"columnName":"miniappDetails","type":"object","hide":true,"encryption":true,"sqlColumnName":"APP_ID","name":"miniappDetails","properties":[{"columnName":"name","type":"String","sqlColumnName":"NAME","filters":["hostingDetailsMiniappDetailsNameNInFilter","hostingDetailsMiniappDetailsNameEqFilter","hostingDetailsMiniappDetailsNameNEqFilter","hostingDetailsMiniappDetailsNameInFilter"]},{"columnName":"description","type":"String","sqlColumnName":"DESCRIPTION","filters":["hostingDetailsMiniappDetailsDescriptionNInFilter","hostingDetailsMiniappDetailsDescriptionEqFilter","hostingDetailsMiniappDetailsDescriptionNEqFilter","hostingDetailsMiniappDetailsDescriptionInFilter"]},{"columnName":"iconUrl","type":"String","sqlColumnName":"ICON_URL","filters":["hostingDetailsMiniappDetailsIconUrlNInFilter","hostingDetailsMiniappDetailsIconUrlEqFilter","hostingDetailsMiniappDetailsIconUrlNEqFilter","hostingDetailsMiniappDetailsIconUrlInFilter"]},{"columnName":"version","type":"String","sqlColumnName":"VERSION","filters":["hostingDetailsMiniappDetailsVersionNInFilter","hostingDetailsMiniappDetailsVersionEqFilter","hostingDetailsMiniappDetailsVersionNEqFilter","hostingDetailsMiniappDetailsVersionInFilter"]},{"columnName":"applicationKey","type":"String","sqlColumnName":"APPLICATION_KEY","filters":["hostingDetailsMiniappDetailsApplicationKeyNInFilter","hostingDetailsMiniappDetailsApplicationKeyEqFilter","hostingDetailsMiniappDetailsApplicationKeyNEqFilter","hostingDetailsMiniappDetailsApplicationKeyInFilter"]},{"columnName":"tagging","type":"String","sqlColumnName":"TAGGING","filters":["hostingDetailsMiniappDetailsTaggingNInFilter","hostingDetailsMiniappDetailsTaggingEqFilter","hostingDetailsMiniappDetailsTaggingNEqFilter","hostingDetailsMiniappDetailsTaggingInFilter"]},{"columnName":"HostingDetails","type":"Reference","sqlColumnName":"HOSTINGDETAILS"},{"columnName":"MiniappBuildDetails","type":"Reference","sqlColumnName":"MINIAPPBUILDDETAILS"},{"columnName":"id","type":"Integer","sqlColumnName":"ID","filters":["hostingDetailsMiniappDetailsIdNInFilter","hostingDetailsMiniappDetailsIdEqFilter","hostingDetailsMiniappDetailsIdNEqFilter","hostingDetailsMiniappDetailsIdInFilter","hostingDetailsMiniappDetailsIdGtFilter","hostingDetailsMiniappDetailsIdLtFilter"]}]},{"columnName":"environment","type":"String","hide":true,"encryption":true,"sqlColumnName":"ENVIRONMENT","filters":["hostingDetailsEnvironmentNInFilter","hostingDetailsEnvironmentEqFilter","hostingDetailsEnvironmentNEqFilter","hostingDetailsEnvironmentInFilter"]},{"columnName":"domain","type":"String","hide":true,"encryption":true,"sqlColumnName":"DOMAIN","filters":["hostingDetailsDomainNInFilter","hostingDetailsDomainEqFilter","hostingDetailsDomainNEqFilter","hostingDetailsDomainInFilter"]},{"columnName":"sslCertificate","type":"Journal","hide":true,"encryption":true,"sqlColumnName":"SSL_CERTIFICATE","filters":["hostingDetailsSslCertificateNInFilter","hostingDetailsSslCertificateEqFilter","hostingDetailsSslCertificateNEqFilter","hostingDetailsSslCertificateInFilter"]},{"columnName":"id","type":"Integer","hide":true,"encryption":true,"sqlColumnName":"ID","filters":["hostingDetailsIdNInFilter","hostingDetailsIdEqFilter","hostingDetailsIdNEqFilter","hostingDetailsIdInFilter","hostingDetailsIdGtFilter","hostingDetailsIdLtFilter"]}],"appliedFor":"ALL","sqlTableName":"HOSTING_DETAILS"},{"entityName":"com.enttribe.superapp.model.MiniappBuildDetails","entityAndCoulmnRestriction":true,"columns":[{"columnName":"miniappDetails","type":"object","hide":true,"encryption":true,"sqlColumnName":"APP_ID","name":"miniappDetails","properties":[{"columnName":"name","type":"String","sqlColumnName":"NAME","filters":["miniappBuildDetailsMiniappDetailsNameNInFilter","miniappBuildDetailsMiniappDetailsNameEqFilter","miniappBuildDetailsMiniappDetailsNameNEqFilter","miniappBuildDetailsMiniappDetailsNameInFilter"]},{"columnName":"description","type":"String","sqlColumnName":"DESCRIPTION","filters":["miniappBuildDetailsMiniappDetailsDescriptionNInFilter","miniappBuildDetailsMiniappDetailsDescriptionEqFilter","miniappBuildDetailsMiniappDetailsDescriptionNEqFilter","miniappBuildDetailsMiniappDetailsDescriptionInFilter"]},{"columnName":"iconUrl","type":"String","sqlColumnName":"ICON_URL","filters":["miniappBuildDetailsMiniappDetailsIconUrlNInFilter","miniappBuildDetailsMiniappDetailsIconUrlEqFilter","miniappBuildDetailsMiniappDetailsIconUrlNEqFilter","miniappBuildDetailsMiniappDetailsIconUrlInFilter"]},{"columnName":"version","type":"String","sqlColumnName":"VERSION","filters":["miniappBuildDetailsMiniappDetailsVersionNInFilter","miniappBuildDetailsMiniappDetailsVersionEqFilter","miniappBuildDetailsMiniappDetailsVersionNEqFilter","miniappBuildDetailsMiniappDetailsVersionInFilter"]},{"columnName":"applicationKey","type":"String","sqlColumnName":"APPLICATION_KEY","filters":["miniappBuildDetailsMiniappDetailsApplicationKeyNInFilter","miniappBuildDetailsMiniappDetailsApplicationKeyEqFilter","miniappBuildDetailsMiniappDetailsApplicationKeyNEqFilter","miniappBuildDetailsMiniappDetailsApplicationKeyInFilter"]},{"columnName":"tagging","type":"String","sqlColumnName":"TAGGING","filters":["miniappBuildDetailsMiniappDetailsTaggingNInFilter","miniappBuildDetailsMiniappDetailsTaggingEqFilter","miniappBuildDetailsMiniappDetailsTaggingNEqFilter","miniappBuildDetailsMiniappDetailsTaggingInFilter"]},{"columnName":"HostingDetails","type":"Reference","sqlColumnName":"HOSTINGDETAILS"},{"columnName":"MiniappBuildDetails","type":"Reference","sqlColumnName":"MINIAPPBUILDDETAILS"},{"columnName":"id","type":"Integer","sqlColumnName":"ID","filters":["miniappBuildDetailsMiniappDetailsIdNInFilter","miniappBuildDetailsMiniappDetailsIdEqFilter","miniappBuildDetailsMiniappDetailsIdNEqFilter","miniappBuildDetailsMiniappDetailsIdInFilter","miniappBuildDetailsMiniappDetailsIdGtFilter","miniappBuildDetailsMiniappDetailsIdLtFilter"]}]},{"columnName":"sourceCodeUrl","type":"String","hide":true,"encryption":true,"sqlColumnName":"SOURCE_CODE URL","filters":["miniappBuildDetailsSourceCodeUrlNInFilter","miniappBuildDetailsSourceCodeUrlEqFilter","miniappBuildDetailsSourceCodeUrlNEqFilter","miniappBuildDetailsSourceCodeUrlInFilter"]},{"columnName":"compiledFileUrl","type":"String","hide":true,"encryption":true,"sqlColumnName":"COMPILED_FILE URL","filters":["miniappBuildDetailsCompiledFileUrlNInFilter","miniappBuildDetailsCompiledFileUrlEqFilter","miniappBuildDetailsCompiledFileUrlNEqFilter","miniappBuildDetailsCompiledFileUrlInFilter"]},{"columnName":"sourceCodePath","type":"String","hide":true,"encryption":true,"sqlColumnName":"SOURCE_CODE PATH","filters":["miniappBuildDetailsSourceCodePathNInFilter","miniappBuildDetailsSourceCodePathEqFilter","miniappBuildDetailsSourceCodePathNEqFilter","miniappBuildDetailsSourceCodePathInFilter"]},{"columnName":"status","type":"enum","hide":true,"encryption":true,"sqlColumnName":"STATUS","values":["NEW","PASS","FAIL"],"filters":["miniappBuildDetailsStatusNInFilter","miniappBuildDetailsStatusEqFilter","miniappBuildDetailsStatusNEqFilter","miniappBuildDetailsStatusInFilter"]},{"columnName":"id","type":"Integer","hide":true,"encryption":true,"sqlColumnName":"ID","filters":["miniappBuildDetailsIdNInFilter","miniappBuildDetailsIdEqFilter","miniappBuildDetailsIdNEqFilter","miniappBuildDetailsIdInFilter","miniappBuildDetailsIdGtFilter","miniappBuildDetailsIdLtFilter"]}],"appliedFor":"ALL","sqlTableName":"MINIAPP_BUILD DETAILS"},{"entityName":"com.enttribe.superapp.model.MiniappDetails","entityAndCoulmnRestriction":true,"columns":[{"columnName":"name","type":"String","hide":true,"encryption":true,"sqlColumnName":"NAME","filters":["miniappDetailsNameNInFilter","miniappDetailsNameEqFilter","miniappDetailsNameNEqFilter","miniappDetailsNameInFilter"]},{"columnName":"description","type":"String","hide":true,"encryption":true,"sqlColumnName":"DESCRIPTION","filters":["miniappDetailsDescriptionNInFilter","miniappDetailsDescriptionEqFilter","miniappDetailsDescriptionNEqFilter","miniappDetailsDescriptionInFilter"]},{"columnName":"iconUrl","type":"String","hide":true,"encryption":true,"sqlColumnName":"ICON_URL","filters":["miniappDetailsIconUrlNInFilter","miniappDetailsIconUrlEqFilter","miniappDetailsIconUrlNEqFilter","miniappDetailsIconUrlInFilter"]},{"columnName":"version","type":"String","hide":true,"encryption":true,"sqlColumnName":"VERSION","filters":["miniappDetailsVersionNInFilter","miniappDetailsVersionEqFilter","miniappDetailsVersionNEqFilter","miniappDetailsVersionInFilter"]},{"columnName":"applicationKey","type":"String","hide":true,"encryption":true,"sqlColumnName":"APPLICATION_KEY","filters":["miniappDetailsApplicationKeyNInFilter","miniappDetailsApplicationKeyEqFilter","miniappDetailsApplicationKeyNEqFilter","miniappDetailsApplicationKeyInFilter"]},{"columnName":"tagging","type":"String","hide":true,"encryption":true,"sqlColumnName":"TAGGING","filters":["miniappDetailsTaggingNInFilter","miniappDetailsTaggingEqFilter","miniappDetailsTaggingNEqFilter","miniappDetailsTaggingInFilter"]},{"columnName":"HostingDetails","type":"object","hide":true,"encryption":true,"sqlColumnName":"HOSTINGDETAILS","name":"HostingDetails","properties":[{"columnName":"miniappDetails","type":"Reference","sqlColumnName":"APP_ID"},{"columnName":"environment","type":"String","sqlColumnName":"ENVIRONMENT","filters":["miniappDetailsHostingDetailsEnvironmentNInFilter","miniappDetailsHostingDetailsEnvironmentEqFilter","miniappDetailsHostingDetailsEnvironmentNEqFilter","miniappDetailsHostingDetailsEnvironmentInFilter"]},{"columnName":"domain","type":"String","sqlColumnName":"DOMAIN","filters":["miniappDetailsHostingDetailsDomainNInFilter","miniappDetailsHostingDetailsDomainEqFilter","miniappDetailsHostingDetailsDomainNEqFilter","miniappDetailsHostingDetailsDomainInFilter"]},{"columnName":"sslCertificate","type":"Journal","sqlColumnName":"SSL_CERTIFICATE","filters":["miniappDetailsHostingDetailsSslCertificateNInFilter","miniappDetailsHostingDetailsSslCertificateEqFilter","miniappDetailsHostingDetailsSslCertificateNEqFilter","miniappDetailsHostingDetailsSslCertificateInFilter"]},{"columnName":"id","type":"Integer","sqlColumnName":"ID","filters":["miniappDetailsHostingDetailsIdNInFilter","miniappDetailsHostingDetailsIdEqFilter","miniappDetailsHostingDetailsIdNEqFilter","miniappDetailsHostingDetailsIdInFilter","miniappDetailsHostingDetailsIdGtFilter","miniappDetailsHostingDetailsIdLtFilter"]}]},{"columnName":"MiniappBuildDetails","type":"object","hide":true,"encryption":true,"sqlColumnName":"MINIAPPBUILDDETAILS","name":"MiniappBuildDetails","properties":[{"columnName":"miniappDetails","type":"Reference","sqlColumnName":"APP_ID"},{"columnName":"sourceCodeUrl","type":"String","sqlColumnName":"SOURCE_CODE URL","filters":["miniappDetailsMiniappBuildDetailsSourceCodeUrlNInFilter","miniappDetailsMiniappBuildDetailsSourceCodeUrlEqFilter","miniappDetailsMiniappBuildDetailsSourceCodeUrlNEqFilter","miniappDetailsMiniappBuildDetailsSourceCodeUrlInFilter"]},{"columnName":"compiledFileUrl","type":"String","sqlColumnName":"COMPILED_FILE URL","filters":["miniappDetailsMiniappBuildDetailsCompiledFileUrlNInFilter","miniappDetailsMiniappBuildDetailsCompiledFileUrlEqFilter","miniappDetailsMiniappBuildDetailsCompiledFileUrlNEqFilter","miniappDetailsMiniappBuildDetailsCompiledFileUrlInFilter"]},{"columnName":"sourceCodePath","type":"String","sqlColumnName":"SOURCE_CODE PATH","filters":["miniappDetailsMiniappBuildDetailsSourceCodePathNInFilter","miniappDetailsMiniappBuildDetailsSourceCodePathEqFilter","miniappDetailsMiniappBuildDetailsSourceCodePathNEqFilter","miniappDetailsMiniappBuildDetailsSourceCodePathInFilter"]},{"columnName":"status","type":"enum","sqlColumnName":"STATUS","values":["NEW","PASS","FAIL"],"filters":["miniappDetailsMiniappBuildDetailsStatusNInFilter","miniappDetailsMiniappBuildDetailsStatusEqFilter","miniappDetailsMiniappBuildDetailsStatusNEqFilter","miniappDetailsMiniappBuildDetailsStatusInFilter"]},{"columnName":"id","type":"Integer","sqlColumnName":"ID","filters":["miniappDetailsMiniappBuildDetailsIdNInFilter","miniappDetailsMiniappBuildDetailsIdEqFilter","miniappDetailsMiniappBuildDetailsIdNEqFilter","miniappDetailsMiniappBuildDetailsIdInFilter","miniappDetailsMiniappBuildDetailsIdGtFilter","miniappDetailsMiniappBuildDetailsIdLtFilter"]}]},{"columnName":"id","type":"Integer","hide":true,"encryption":true,"sqlColumnName":"ID","filters":["miniappDetailsIdNInFilter","miniappDetailsIdEqFilter","miniappDetailsIdNEqFilter","miniappDetailsIdInFilter","miniappDetailsIdGtFilter","miniappDetailsIdLtFilter"]}],"appliedFor":"ALL","sqlTableName":"MINIAPP_DETAILS"}]}]}]' -H "Accept: application/json, text/plain, */*" -H "Content-Type: application/json" -H "authorization: Bearer "$token"" -H "audience: "$gateWayContext"" -X POST $hostUrl/base/1.0/base/util/rest/resourceConfig/createOrUpdateResourceConfig?appName=$applicationName)
echo $aoaImport


